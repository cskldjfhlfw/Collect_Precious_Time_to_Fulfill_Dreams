# 环境配置指南

本文档详细说明了如何从零开始配置科研成果管理系统的开发环境。

## 1. 基础环境要求

在开始之前，请确保您的系统满足以下要求：

| 软件 | 版本要求 | 说明 |
|------|----------|------|
| **Python** | 3.11+ | 后端开发语言 |
| **Node.js** | 18+ | 前端运行时 |
| **PostgreSQL** | 15+ | 主关系型数据库 |
| **MongoDB** | 6.0+ | 文档型数据库（日志、全文搜索） |
| **Redis** | 6.0+ | 缓存服务 |
| **Neo4j** | 5.0+ | 知识图谱数据库 |

---

## 2. 软件安装指南

### 🐍 Python 安装
- **Windows**: 访问 [Python官网](https://www.python.org/downloads/) 下载安装包。安装时务必勾选 "Add Python to PATH"。
- **macOS**: 使用 Homebrew 安装: `brew install python`
- **Linux**: 使用包管理器安装: `sudo apt install python3 python3-venv python3-pip`

### 📦 Node.js 安装
- 推荐使用 LTS 版本。
- **下载**: 访问 [Node.js官网](https://nodejs.org/)。
- **验证**: 终端运行 `node -v` 和 `npm -v`。

### 🐘 PostgreSQL 安装
- **下载**: 访问 [PostgreSQL官网](https://www.postgresql.org/download/)。
- **配置**: 安装过程中设置超级用户 `postgres` 的密码（建议开发环境设为 `123456`，方便调试）。
- **创建数据库**: 安装完成后，使用 pgAdmin 或命令行创建名为 `research` 的数据库。

### 🍃 MongoDB 安装
- **下载**: 访问 [MongoDB Community Server](https://www.mongodb.com/try/download/community)。
- **工具**: 推荐安装 MongoDB Compass 用于可视化管理。
- **验证**: 浏览器访问 `http://localhost:27017` 应显示相关信息。

### 🔴 Redis 安装
- **Windows**: 可以使用 [Memurai](https://www.memurai.com/) 或 WSL 安装。
- **macOS/Linux**: `brew install redis` 或 `sudo apt install redis-server`。

### 🕸️ Neo4j 安装
- **下载**: 访问 [Neo4j Desktop](https://neo4j.com/download/)。
- **配置**: 创建一个新的 Project，并启动一个 DBMS。记下 Bolt 端口（默认 7687）和密码。

---

## 3. 后端环境配置

### 3.1 获取代码
```bash
cd back
```

### 3.2 创建虚拟环境
推荐使用 Python 虚拟环境隔离依赖。

**Windows (PowerShell)**:
```powershell
python -m venv venv
.\venv\Scripts\Activate
```

**macOS/Linux**:
```bash
python3 -m venv venv
source venv/bin/activate
```

### 3.3 安装依赖
```bash
pip install -r requirements.txt
```

### 3.4 环境变量配置
复制示例配置文件并修改：
```bash
cp .env.example .env
```

编辑 `.env` 文件，确保数据库连接信息与您本地安装的一致：
```ini
# 数据库配置示例
APP_POSTGRES_DSN="postgresql+asyncpg://postgres:123456@localhost:5432/research"
APP_MONGO_DSN="mongodb://localhost:27017"
APP_REDIS_DSN="redis://localhost:6379/0"
APP_NEO4J_URI="bolt://localhost:7687"
APP_NEO4J_PASSWORD="你的密码"
```

### 3.5 数据库初始化
确保所有数据库服务已启动，然后运行初始化脚本：
```bash
# 验证连接并初始化表结构
python init_database.py

# 或者使用 Alembic 进行迁移
alembic upgrade head
```

---

## 4. 前端环境配置

### 4.1 获取代码
打开新的终端窗口：
```bash
cd front
```

### 4.2 安装依赖
```bash
npm install
# 或者使用 pnpm (推荐)
# npm install -g pnpm
# pnpm install
```

### 4.3 环境变量配置
如果需要自定义 API 地址，创建 `.env.local` 文件：
```ini
NEXT_PUBLIC_API_URL=http://localhost:8000/api
```

---

## 5. 启动与验证

### 5.1 启动后端
在 `back` 目录（确保虚拟环境已激活）：
```bash
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```
访问 [http://localhost:8000/docs](http://localhost:8000/docs) 查看 API 文档。

### 5.2 启动前端
在 `front` 目录：
```bash
npm run dev
```
访问 [http://localhost:3000](http://localhost:3000) 查看系统界面。

## 6. 常见问题

- **数据库连接失败**: 检查 `.env` 中的端口和密码是否正确，确认服务已在后台运行。
- **缺少模块**: 确保在虚拟环境中运行了 `pip install -r requirements.txt`。
- **端口占用**: 确保 8000 和 3000 端口未被其他程序占用。
